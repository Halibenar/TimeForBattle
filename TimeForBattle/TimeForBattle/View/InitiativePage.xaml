<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:model="clr-namespace:TimeForBattle.Model"
             xmlns:viewmodel="clr-namespace:TimeForBattle.ViewModel"
             x:DataType="viewmodel:InitiativeViewModel"
             Title="{Binding Title}"
             x:Class="TimeForBattle.View.InitiativePage"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Name="root">

    <Grid ColumnDefinitions="40,*,*,*"
          ColumnSpacing="0"
          RowDefinitions="Auto,Auto,*">

        <Button Grid.Column="1"
                Grid.Row="0"
                Text="Roll"
                Command="{Binding RollInitiativeCommand}"/>
        <Button Grid.Column="2"
                Grid.Row="0"
                Text="Sort"
                Command="{Binding SortInitiativeCommand}" />

        <Button Grid.Column="1"
                Grid.Row="1"
                Text="Previous" />

        <Label Grid.Column="2"
            Grid.Row="1"
            Text="..." />

        <Button Grid.Column="3"
                Grid.Row="1"
                Text="Next" />

        <ScrollView Grid.Column="1"
                    Grid.ColumnSpan="3"
                    Grid.Row="2">
            <FlexLayout BackgroundColor="Transparent"
                        BindableLayout.ItemsSource="{Binding Initiative}"
                        HorizontalOptions="Start"
                        Direction="Column"
                        Wrap="NoWrap"
                        JustifyContent="Start"
                        AlignContent="Start">
                <BindableLayout.ItemTemplate>
                    <DataTemplate x:DataType="model:InitiativeCreature">
                        <Border Stroke="DarkRed"
                                StrokeThickness="2">
                            <toolkit:Expander Grid.Column="0"
                                              Grid.ColumnSpan="4"
                                              Grid.Row="0"
                                              Grid.RowSpan="1">
                                <toolkit:Expander.Header>
                                    <Grid ColumnDefinitions="*,*,*,*"
                                          ColumnSpacing="0"
                                          RowDefinitions="*"
                                          RowSpacing="0"
                                          Padding="3,3,3,3">

                                        <Entry Grid.Column="0"
                                               Grid.Row="0"
                                               Text="{Binding Initiative}"
                                               WidthRequest="35"
                                               MinimumWidthRequest="35"
                                               VerticalOptions="Center"
                                               MaxLength="2"
                                               Keyboard="Numeric"
                                               Completed="Entry_TextCompleted"/>
                                        <Label Grid.Column="1"
                                               Grid.Row="0"
                                               Text="{Binding Name}"
                                               VerticalOptions="Center" />
                                        <Entry Grid.Column="2"
                                               Grid.Row="0"
                                               Text="{Binding GridID}"
                                               WidthRequest="45"
                                               MinimumWidthRequest="45"
                                               VerticalOptions="Center"
                                               MaxLength="3"
                                               Keyboard="Numeric" />
                                    </Grid>
                                </toolkit:Expander.Header>
                                <Grid ColumnDefinitions="*,*,*,*"
                                      ColumnSpacing="0"
                                      RowDefinitions="*,*"
                                      RowSpacing="0"
                                      Padding="3,3,3,3">
                                    <Button Grid.Column="0"
                                            Grid.Row="0"
                                            Text="+"
                                            VerticalOptions="Center"
                                            WidthRequest="40"
                                            HeightRequest="20" />
                                    <Button Grid.Column="0"
                                            Grid.Row="1"
                                            Text="-"
                                            VerticalOptions="Center"
                                            WidthRequest="40"
                                            HeightRequest="20" />
                                    <Entry Grid.Column="1"
                                           Grid.Row="0"
                                           Grid.RowSpan="2"
                                           Text="{Binding CurrentHitPoints}"
                                           WidthRequest="45"
                                           MinimumWidthRequest="45"
                                           VerticalOptions="Center"
                                           MaxLength="3"
                                           Keyboard="Numeric" />
                                    <Label Grid.Column="2"
                                           Grid.Row="0"
                                           Grid.RowSpan="2"
                                           Text="{Binding MaximumHitPoints, StringFormat='{} / {0}'}"
                                           VerticalOptions="Center" />
                                    <Button x:Name="RemoveButton"
                                            Grid.Column="3"
                                            Grid.Row="0"
                                            Grid.RowSpan="2"
                                            Text="Remove"
                                            WidthRequest="80"
                                            CommandParameter="{Binding .}"
                                            Command="{Binding x:DataType='viewmodel:CreatureListViewModel', Source={RelativeSource AncestorType={x:Type viewmodel:CreatureListViewModel}}, Path=RemoveFromInitiativeCommand}" />
                                </Grid>
                            </toolkit:Expander>
                        </Border>
                    </DataTemplate>
                </BindableLayout.ItemTemplate>
            </FlexLayout>
        </ScrollView>
    </Grid>
</ContentPage>